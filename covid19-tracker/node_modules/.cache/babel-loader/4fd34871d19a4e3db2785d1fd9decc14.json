{"ast":null,"code":"var _jsxFileName = \"/Users/alexacevedo/git/CovidTracker_Cs481/covid19-tracker/src/components/Globe/Globe.js\";\nimport React, { useState, useEffect, useMemo, useRef } from 'react';\nimport Globe from 'react-globe.gl';\nimport { getPolygonLabel } from './Label';\nimport * as d3 from 'd3';\nimport TimeLine from './AdditonalInfo';\nimport Spinner from './Spinner';\nimport './Globe.css';\nimport Modal from '../Modal/Modal.js';\nimport { BsSearch } from 'react-icons/bs';\n\nconst World = props => {\n  const globeEl = useRef();\n  const [countries, setCountries] = useState({\n    features: []\n  });\n  const [hoverD, setHoverD] = useState();\n  const [dimension, setDimension] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight\n  });\n  const [worldTotal, setTotal] = useState({\n    infected: 0,\n    deaths: 0,\n    recovered: 0\n  });\n  const [loading, setLoading] = useState(false);\n  const [modalState, setModalState] = useState(false);\n  const [data, setData] = useState([]);\n  const [countryInfo, setCountryInfo] = useState({\n    name: '',\n    caseperM: 0,\n    deathsperM: 0,\n    totalCase: 0,\n    testperM: 0\n  });\n  const [search, setSearch] = useState(false);\n  useEffect(() => {\n    window.addEventListener('resize', () => {\n      setDimension({\n        width: window.innerWidth,\n        height: window.innerHeight\n      });\n    });\n    globeEl.current.controls().autoRotate = true;\n    globeEl.current.controls().autoRotateSpeed = 0.7;\n\n    const fetchData = async () => {\n      let covidData = await fetch(\"https://corona.lmao.ninja/v2/countries\").then(res => res.json());\n      let data = await fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson').then(res => res.json());\n      let totalDeaths = 0,\n          totalCases = 0,\n          recoveries = 0;\n      let covid = new Map();\n      covidData.forEach(value => {\n        covid.set(value.countryInfo.iso2, {\n          iso2: value.countryInfo.iso2,\n          totalCases: value.cases,\n          totalDeaths: value.deaths,\n          recoveries: value.recovered,\n          activeCases: value.active,\n          deathsPerOneMillion: value.deathsPerOneMillion,\n          casesPerOneMillion: value.casesPerOneMillion,\n          testsPerOneMillion: value.testsPerOneMillion\n        });\n      });\n      data.features.forEach((value, i, array) => {\n        let found = covid.get(array[i].properties.ISO_A2);\n\n        if (found === undefined) {\n          array[i].properties.totalCases = 0;\n          array[i].properties.totalDeaths = 0;\n          array[i].properties.recoveries = 0;\n          array[i].properties.activeCases = 0;\n          array[i].properties.caseperM = 0;\n          array[i].properties.deathsperM = 0;\n        } else {\n          array[i].properties.totalCases = found.totalCases;\n          array[i].properties.totalDeaths = found.totalDeaths;\n          array[i].properties.recoveries = found.recoveries;\n          array[i].properties.activeCases = found.activeCases;\n          array[i].properties.caseperM = found.casesPerOneMillion;\n          array[i].properties.deathsperM = found.deathsPerOneMillion;\n          array[i].properties.testperM = found.testsPerOneMillion;\n          totalCases += Number(found.totalCases);\n          totalDeaths += Number(found.totalDeaths);\n          recoveries += Number(found.recoveries);\n        }\n      });\n      setCountries(data);\n      setTotal({\n        infected: totalCases,\n        deaths: totalDeaths,\n        recovered: recoveries\n      });\n      setLoading(true);\n      setModalState(false);\n    };\n\n    fetchData();\n  }, []); // Getting the scale small enough so the globe looks nicer\n\n  const getVal = feat => {\n    return Math.pow(feat.properties.activeCases / feat.properties.POP_EST, 1 / 4);\n  };\n\n  const maxVal = useMemo(() => Math.max(...countries.features.map(getVal)), [countries]);\n  const colorScale = d3.scaleSequential(d3.interpolateReds);\n  colorScale.domain([0, maxVal]);\n\n  function getFlagName(d) {\n    switch (d.ADMIN) {\n      case \"France\":\n        return \"fr\";\n\n      case \"Norway\":\n        return \"no\";\n\n      default:\n        return d.ISO_A2.toLowerCase();\n    }\n  }\n\n  function handleSearch() {\n    if (document.getElementsByClassName('scene-tooltip')[0].style.display == '') {\n      document.getElementsByClassName('scene-tooltip')[0].style.display = \"none\";\n    } else {\n      document.getElementsByClassName('scene-tooltip')[0].style.display = '';\n    }\n\n    setSearch(!search);\n  }\n\n  async function handleCountrySearch(e) {\n    if (e.key === 'Enter') {\n      let country_name = e.target.value.toLowerCase();\n      let country_data = await fetch(`https://disease.sh/v3/covid-19/countries/${country_name}`).then(res => {\n        if (res.status === 404) {\n          return 404;\n        }\n\n        return res.json();\n      });\n\n      if (typeof country_data === 'number') {\n        document.getElementById('search_field').value = \"\";\n      } else {\n        setCountryInfo({\n          name: country_data.country,\n          caseperM: country_data.casesPerOneMillion,\n          deathsperM: country_data.deathsPerOneMillion,\n          totalCase: country_data.totalCases,\n          testperM: country_data.testsPerOneMillion\n        });\n        setModalState(true);\n        setData([country_data.active, country_data.deaths, country_data.recovered]);\n        document.getElementById('search_field').value = \"\";\n      }\n    }\n  }\n\n  function handleClose() {\n    setModalState(false);\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"Canvas_Container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-info-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 6\n    }\n  }, !search ? /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 18\n    }\n  }, \"COVID-19 GLOBE TRACKER\") : /*#__PURE__*/React.createElement(\"input\", {\n    id: \"search_field\",\n    onKeyDown: handleCountrySearch,\n    placeholder: \"Search\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 48\n    }\n  }), /*#__PURE__*/React.createElement(BsSearch, {\n    onClick: handleSearch,\n    className: \"search\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 8\n    }\n  })), search ? /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 13\n    }\n  }, \"Type the country name, iso2, or iso3 and press enter\") : null), loading ? null : /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(Modal, {\n    show: modalState,\n    handleClose: handleClose,\n    name: countryInfo,\n    data: data,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Globe, {\n    globeImageUrl: \"//unpkg.com/three-globe/example/img/earth-night.jpg\",\n    backgroundImageUrl: \"//unpkg.com/three-globe/example/img/night-sky.png\",\n    width: dimension.width,\n    height: dimension.height,\n    ref: globeEl,\n    showAtmosphere: false,\n    polygonsData: countries.features,\n    polygonAltitude: d => d === hoverD ? 0.12 : 0.06,\n    polygonCapColor: d => d === hoverD ? '#eceac4' : colorScale(getVal(d)),\n    polygonSideColor: () => 'rgba(0, 100, 0, 0.15)',\n    polygonStrokeColor: () => '#111',\n    polygonLabel: ({\n      properties: d\n    }) => {\n      const flagName = getFlagName(d);\n      return getPolygonLabel(flagName, d);\n    },\n    onPolygonHover: setHoverD,\n    onPolygonClick: ({\n      properties: d\n    }, e) => {\n      setModalState(true);\n      setData([d.activeCases, d.totalDeaths, d.recoveries]);\n      setCountryInfo({\n        name: d.ADMIN,\n        caseperM: d.caseperM,\n        deathsperM: d.deathsperM,\n        totalCase: d.totalCases,\n        testperM: d.testperM\n      });\n    },\n    polygonsTransitionDuration: 300,\n    onGlobeClick: ({\n      lat,\n      lng\n    }, event) => {\n      globeEl.current.controls().autoRotateSpeed = !globeEl.current.controls().autoRotateSpeed;\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(TimeLine, {\n    infected: worldTotal.infected,\n    deaths: worldTotal.deaths,\n    recovered: worldTotal.recovered,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 9\n    }\n  }));\n};\n\nexport default World;","map":{"version":3,"sources":["/Users/alexacevedo/git/CovidTracker_Cs481/covid19-tracker/src/components/Globe/Globe.js"],"names":["React","useState","useEffect","useMemo","useRef","Globe","getPolygonLabel","d3","TimeLine","Spinner","Modal","BsSearch","World","props","globeEl","countries","setCountries","features","hoverD","setHoverD","dimension","setDimension","width","window","innerWidth","height","innerHeight","worldTotal","setTotal","infected","deaths","recovered","loading","setLoading","modalState","setModalState","data","setData","countryInfo","setCountryInfo","name","caseperM","deathsperM","totalCase","testperM","search","setSearch","addEventListener","current","controls","autoRotate","autoRotateSpeed","fetchData","covidData","fetch","then","res","json","totalDeaths","totalCases","recoveries","covid","Map","forEach","value","set","iso2","cases","activeCases","active","deathsPerOneMillion","casesPerOneMillion","testsPerOneMillion","i","array","found","get","properties","ISO_A2","undefined","Number","getVal","feat","Math","pow","POP_EST","maxVal","max","map","colorScale","scaleSequential","interpolateReds","domain","getFlagName","d","ADMIN","toLowerCase","handleSearch","document","getElementsByClassName","style","display","handleCountrySearch","e","key","country_name","target","country_data","status","getElementById","country","handleClose","flagName","lat","lng","event"],"mappings":"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","sourcesContent":["import React, {useState, useEffect, useMemo, useRef} from 'react'\nimport Globe from 'react-globe.gl';\nimport {getPolygonLabel} from './Label';\nimport * as d3 from 'd3'\nimport TimeLine from './AdditonalInfo';\nimport Spinner from './Spinner';\nimport './Globe.css';\nimport Modal from '../Modal/Modal.js';\nimport {BsSearch} from 'react-icons/bs';\n\nconst World = (props)=>{\n  const globeEl = useRef();\n  const [countries, setCountries] = useState({ features: []});\n    const [hoverD, setHoverD] = useState();\n    const [dimension,setDimension] = useState({width:window.innerWidth,height:window.innerHeight})\n    const [worldTotal,setTotal] = useState({infected:0, deaths:0,recovered:0})\n    const [loading,setLoading] =useState(false);\n    const [modalState,setModalState] = useState(false);\n    const [data,setData] =useState([]);\n    const [countryInfo, setCountryInfo] = useState({name:'',caseperM:0,deathsperM:0,totalCase:0,testperM:0});\n    const [search,setSearch] =useState(false);\n\n    useEffect(() => {\n\n        window.addEventListener('resize', () => {\n          setDimension({width:window.innerWidth,height:window.innerHeight});\n        });\n        globeEl.current.controls().autoRotate = true;\n      globeEl.current.controls().autoRotateSpeed = 0.7;\n     const fetchData= async() =>{\n      let covidData = await fetch(\"https://corona.lmao.ninja/v2/countries\").then(res=>res.json());\n      \n      let data = await fetch('https://raw.githubusercontent.com/nvkelso/natural-earth-vector/master/geojson/ne_110m_admin_0_countries.geojson').then(res => res.json());\n      let totalDeaths=0,totalCases=0,recoveries =0;\n      let covid = new Map();\n      covidData.forEach(value=>{\n\n          covid.set(value.countryInfo.iso2,{\n              iso2:value.countryInfo.iso2,\n              totalCases: value.cases,\n              totalDeaths:value.deaths,\n              recoveries:value.recovered,\n              activeCases:value.active,\n              deathsPerOneMillion:value.deathsPerOneMillion,\n              casesPerOneMillion:value.casesPerOneMillion,\n              testsPerOneMillion:value.testsPerOneMillion\n          })\n      })\n      data.features.forEach((value,i,array)=>{\n        let found = covid.get(array[i].properties.ISO_A2)\n        if(found===undefined){\n            array[i].properties.totalCases = 0;\n            array[i].properties.totalDeaths = 0;\n            array[i].properties.recoveries = 0;\n            array[i].properties.activeCases = 0;\n            array[i].properties.caseperM = 0;\n            array[i].properties.deathsperM =0;\n        }\n        else{\n            array[i].properties.totalCases = found.totalCases;\n            array[i].properties.totalDeaths = found.totalDeaths;\n            array[i].properties.recoveries = found.recoveries;\n            array[i].properties.activeCases = found.activeCases;\n            array[i].properties.caseperM = found.casesPerOneMillion;\n            array[i].properties.deathsperM = found.deathsPerOneMillion;\n            array[i].properties.testperM = found.testsPerOneMillion;\n            totalCases+=Number(found.totalCases);\n            totalDeaths+=Number(found.totalDeaths);\n            recoveries+=Number(found.recoveries);\n        }\n        })\n      \n      setCountries(data);\n      setTotal({infected:totalCases,deaths:totalDeaths,recovered:recoveries});\n      setLoading(true);\n      setModalState(false);\n    }\n\n      fetchData();\n    }, []);\n        // Getting the scale small enough so the globe looks nicer\n        const getVal = feat => {\n            return Math.pow(feat.properties.activeCases / feat.properties.POP_EST, 1 / 4);\n        }    \n        const maxVal = useMemo(\n      () => Math.max(...countries.features.map(getVal)),\n      [countries]\n    );\n        const colorScale = d3.scaleSequential(d3.interpolateReds)\n        colorScale.domain([0, maxVal]);\n    \n        function getFlagName(d) {\n            switch (d.ADMIN) {\n              case \"France\":\n                return \"fr\";\n              case \"Norway\":\n                return \"no\";\n              default:\n                return d.ISO_A2.toLowerCase();\n            }\n          }\n        function handleSearch(){\n          if(document.getElementsByClassName('scene-tooltip')[0].style.display==''){\n            document.getElementsByClassName('scene-tooltip')[0].style.display=\"none\";\n          }\n          else{\n            document.getElementsByClassName('scene-tooltip')[0].style.display='';\n\n          }\n          setSearch(!search);\n        }\n        async function handleCountrySearch(e){\n          if (e.key === 'Enter'){\n            let country_name = e.target.value.toLowerCase();\n           let country_data = await fetch(`https://disease.sh/v3/covid-19/countries/${country_name}`).then(\n            res=>{\n              if(res.status===404){\n                return 404;\n              }\n              return res.json()});\n           if(typeof country_data ==='number'){\n            document.getElementById('search_field').value=\"\";\n           }\n           else{\n           setCountryInfo({\n            name:country_data.country,\n            caseperM:country_data.casesPerOneMillion,\n            deathsperM:country_data.deathsPerOneMillion,\n            totalCase:country_data.totalCases,\n            testperM:country_data.testsPerOneMillion\n          });\n           setModalState(true);\n           setData([country_data.active,country_data.deaths,country_data.recovered]);\n           document.getElementById('search_field').value=\"\";\n            }\n          }\n        }\n          function handleClose(){\n            setModalState(false);\n          }\n        return (\n        <div className=\"Canvas_Container\" >\n          <div className=\"top-info-container\">\n     <div className=\"title\">\n       {!search ?<p>COVID-19 GLOBE TRACKER</p>:<input id=\"search_field\" onKeyDown={handleCountrySearch} placeholder=\"Search\"/> \n        }\n       <BsSearch onClick={handleSearch} className=\"search\"></BsSearch>\n      </div> \n     {/* <input className=\"title\" placeholder=\"INPUT a country\" />*/}\n    {search?<span>Type the country name, iso2, or iso3 and press enter</span>:null}\n    </div>{loading ? null : <Spinner/> }\n        <Modal show={modalState} handleClose={handleClose} name ={countryInfo}data={data}></Modal>\n        <Globe\n          globeImageUrl=\"//unpkg.com/three-globe/example/img/earth-night.jpg\"\n          backgroundImageUrl=\"//unpkg.com/three-globe/example/img/night-sky.png\"\n          width={dimension.width}\n          height={dimension.height}\n          ref={globeEl}\n          showAtmosphere={false}\n          polygonsData={countries.features}\n          polygonAltitude={d => d === hoverD ? 0.12 : 0.06}\n          polygonCapColor={d => d === hoverD ? '#eceac4' : colorScale(getVal(d))}\n          polygonSideColor={() => 'rgba(0, 100, 0, 0.15)'}\n          polygonStrokeColor={() => '#111'}\n          polygonLabel={({ properties: d }) => {\n            const flagName = getFlagName(d);\n            return getPolygonLabel(flagName, d);\n  }}\n          onPolygonHover={setHoverD}\n          onPolygonClick={({ properties: d },e)=>{\n            setModalState(true);\n            setData([d.activeCases,d.totalDeaths,d.recoveries]);\n            setCountryInfo({name:d.ADMIN,caseperM:d.caseperM,deathsperM:d.deathsperM,totalCase:d.totalCases,testperM:d.testperM});\n          }}\n          polygonsTransitionDuration={300}\n          onGlobeClick={({ lat, lng }, event)=>{\n            globeEl.current.controls().autoRotateSpeed = !globeEl.current.controls().autoRotateSpeed;         \n           }}\n        />\n        <TimeLine infected={worldTotal.infected} deaths={worldTotal.deaths} recovered={worldTotal.recovered}/>\n       </div>\n        );\n\n}\n\nexport default World;"]},"metadata":{},"sourceType":"module"}